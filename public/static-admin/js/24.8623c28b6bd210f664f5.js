(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{"14Xm":function(e,t,a){e.exports=a("u938")},"7L4n":function(e,t,a){"use strict";a.r(t);var r=a("EzfB"),n=a.n(r);for(var u in r)"default"!==u&&function(e){a.d(t,e,(function(){return r[e]}))}(u);t.default=n.a},"7WkU":function(e,t,a){"use strict";a.r(t);var r=a("VKou"),n=a("7L4n");for(var u in n)"default"!==u&&function(e){a.d(t,e,(function(){return n[e]}))}(u);var s=a("KHd+"),i=Object(s.a)(n.default,r.a,r.b,!1,null,null,null);t.default=i.exports},D3Ub:function(e,t,a){"use strict";t.__esModule=!0;var r,n=a("4d7F"),u=(r=n)&&r.__esModule?r:{default:r};t.default=function(e){return function(){var t=e.apply(this,arguments);return new u.default((function(e,a){return function r(n,s){try{var i=t[n](s),l=i.value}catch(e){return void a(e)}if(!i.done)return u.default.resolve(l).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(l)}("next")}))}}},EzfB:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(a("QbLZ"));a("I1+7");var n=u(a("fwIo"));function u(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)({name:"search-results-view"},n.default)},VKou:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n}));var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user-search-list-box"},[a("Card",{attrs:{header:"用户搜索结果："}}),e._v(" "),a("div",{staticClass:"user-search-list__table"},[a("div",{staticClass:"user-search-list__table-title"},[a("p",[e._v("共搜索到 "+e._s(e.total)+" 名符合条件的用户")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.$router.push({path:"/admin/user-manage"})}}},[e._v("重新搜索")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:e.exporUserInfo}},[e._v("导出用户信息")])],1),e._v(" "),a("div",{staticClass:"user-search-list__table-cont"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"_data.id",label:"编号",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{label:"头像",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-image",{staticStyle:{width:"32px",height:"32px"},attrs:{src:e.row._data.avatarUrl?e.row._data.avatarUrl:"/static-admin/images/noavatar.gif",lazy:""}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"_data.username",label:"用户名","min-width":"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"_data.threadCount",label:"主题数"}}),e._v(" "),a("el-table-column",{attrs:{prop:"groups[0]._data.name",label:"用户组"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否已付费"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.$dayjs().isSameOrBefore(e.$dayjs(t.row._data.expiredAt))?"success":"info"}},[e._v(e._s(e.$dayjs().isSameOrBefore(e.$dayjs(t.row._data.expiredAt))?"是":"否"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.$router.push({path:"/admin/user-details",query:{id:t.row._data.id}})}}},[e._v("详情")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.$router.push({path:"/admin/wallet",query:{id:t.row._data.id}})}}},[e._v("钱包")]),e._v(" "),a("el-button",{attrs:{type:"text",disabled:1===t.row._data.status},on:{click:function(a){return e.handleDisable(t)}}},[e._v("禁用")])]}}])})],1),e._v(" "),a("Page",{attrs:{total:e.total,pageSize:e.pageLimit,currentPage:e.pageNum},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("Card",{staticClass:"footer-btn"},[a("el-button",{attrs:{size:"medium",disabled:e.deleteStatus},on:{click:e.disabledBatch}},[e._v("禁用")])],1)],1),e._v(" "),e._m(0)],1)},n=[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"user-search-list__prompt"},[t("h1",[this._v("提示：")]),this._v(" "),t("p",[this._v("导出用户信息最多支持 10000 条数据。导出的 .xlsx 文件可用 EXCEL 打开。")])])}]},fwIo:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(a("14Xm")),n=o(a("D3Ub")),u=o(a("4gYi")),s=o(a("pNQN")),i=o(a("rWG0")),l=o(a("VVfg"));function o(e){return e&&e.__esModule?e:{default:e}}t.default={data:function(){return{tableData:[],getRoleNameById:{},multipleSelection:[],deleteStatus:!0,pageLimit:20,pageNum:1,query:{},total:0,disabled:!0}},created:function(){this.query=this.$route.query},beforeRouteEnter:function(e,t,a){a((function(a){e.name!==t.name&&null!==t.name?a.getCreated(!0):a.getCreated(!1)}))},methods:{getCreated:function(e){this.pageNum=e?1:Number(l.default.getLItem("currentPag"))||1,this.handleGetUserList(!0)},handleSelectionChange:function(e){this.multipleSelection=e,this.deleteStatus=this.multipleSelection.length<1},handleGetUserList:function(){var e=this;return(0,n.default)(r.default.mark((function t(){var a,n,u,s,i,l,o,c,d;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=e.query,n=a.username,u=a.userUID,s=a.userRole,i=a.userPhone,l=a.userStatus,o=a.userWeChat,c=a.isReal,t.next=4,e.appFetch({method:"get",url:"users",data:{"filter[username]":n,"filter[id]":u,"filter[group_id][]":s,"filter[mobile]":i,"filter[status]":l,"filter[wechat]":o,"page[limit]":e.pageLimit,"page[number]":e.pageNum,"filter[isReal]":c}});case 4:if(!(d=t.sent).errors){t.next=9;break}throw new Error(d.errors[0].code);case 9:e.total=d.meta.total,e.tableData=d.readdata;case 11:t.next=15;break;case 13:t.prev=13,t.t0=t.catch(0);case 15:case"end":return t.stop()}}),t,e,[[0,13]])})))()},exporUserInfo:function(){var e=this;return(0,n.default)(r.default.mark((function t(){var a,n,u,s,i,l,o,c,d,f,p,h,m,v;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=[],e.multipleSelection.forEach((function(e){a.push(e._data.id)})),n=e.query,u=n.username,s=n.userUID,i=n.userRole,l=n.userPhone,o=n.userStatus,c=n.userWeChat,d=n.isReal,t.next=6,e.appFetch({method:"get",url:"exportUser",splice:"ids="+a,data:{"filter[username]":u,"filter[id]":s,"filter[group_id][]":i,"filter[mobile]":l,"filter[status]":o,"filter[wechat]":c,"filter[isReal]":d},responseType:"arraybuffer"});case 6:f=t.sent,p=new Blob([f],{type:"application/x-xls"}),h=window.URL||window.webkitURL||window.moxURL,m=h.createObjectURL(p),(v=document.createElement("a")).href=m,v.download="export.xlsx",v.click(),v=null,t.next=19;break;case 17:t.prev=17,t.t0=t.catch(0);case 19:case"end":return t.stop()}}),t,e,[[0,17]])})))()},deleteBatch:function(){var e=this;return(0,n.default)(r.default.mark((function t(){var a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.multipleSelection.length<=0)){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,a=[],e.multipleSelection.forEach((function(e){a.push(e._data.id)})),t.next=7,e.appFetch({method:"delete",url:"users",data:{data:{attributes:{id:a}}}});case 7:e.handleGetUserList(),t.next=12;break;case 10:t.prev=10,t.t0=t.catch(2);case 12:case"end":return t.stop()}}),t,e,[[2,10]])})))()},disabledBatch:function(){var e=this;this.multipleSelection.length<=0||this.$MessageBox.prompt("","提示",{confirmButtonText:"提交",cancelButtonText:"取消",inputPlaceholder:"请输入禁用理由"}).then((function(t){if(null!==t.value){var a=[];e.multipleSelection.forEach((function(e){a.push({attributes:{id:e._data.id,groupId:e.groups[0]?e.groups[0]._data.id:"",status:1,refuse_message:t.value}})})),e.appFetch({method:"PATCH",url:"users",data:{data:a}}),e.handleGetUserList()}else e.$message.error("请填写禁用理由")})).catch((function(e){}))},handleDisable:function(e){var t=this;this.$MessageBox.prompt("","提示",{confirmButtonText:"提交",cancelButtonText:"取消",inputPlaceholder:"请输入禁用理由"}).then((function(a){if(null!==a.value){var r=e.row._data;t.appFetch({method:"PATCH",url:"users",splice:"/"+r.id,data:{data:{attributes:{status:1,refuse_message:a.value}}}}).then((function(){t.handleGetUserList(),t.tableData[e.$index]._data.status=1}))}else t.$message.error("请填写禁用理由")})).catch((function(e){}))},handleCurrentChange:function(e){this.pageNum=e,this.handleGetUserList()}},components:{Card:u.default,CardRow:s.default,Page:i.default}}},u938:function(e,t,a){var r=function(){return this}()||Function("return this")(),n=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,u=n&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=a("ls82"),n)r.regeneratorRuntime=u;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}}}]);